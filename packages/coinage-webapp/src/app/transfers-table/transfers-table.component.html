<div class="transfers-table-container">
    @if (showFilters) {
        <div class="header-filters-container">
            <div>
                <input id="showAllCheckbox" [ngModel]="filter.showPlanned" (ngModelChange)="showAllChecked($event)" type="checkbox" />
                <label for="showAllCheckbox">Show planned transfers</label>
            </div>
            <div>
                <input id="showFlaggedCheckbox" [ngModel]="filter.showFlagged" (ngModelChange)="showFlaggedChecked($event)" type="checkbox" />
                <label for="showFlaggedCheckbox">Only flagged transfers</label>
            </div>
        </div>
    }
    @if (showFilters && lastPageNumber) {
        <app-pagination class="float-right" [lastPage]="lastPageNumber" (pageChange)="onPageChanged($event)"></app-pagination>
    }
    <table class="transfers-table">
        @if (isHeaderDisplayed) {
            <caption>
                <span>{{ header }}</span>
            </caption>
        }
        <thead>
            <tr>
                <th class="text-left">
                    <span>Category</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Category"
                            [filterType]="FilterType.MultiCheckbox"
                            [filterOptions]="optionsForCheckboxFilters.categories"
                            [popupSide]="PopupSide.ToRight"
                            [cachedFilterValue]="filter.category"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
                <th>
                    <span>Description</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Description"
                            [filterType]="FilterType.TextBox"
                            [popupSide]="PopupSide.ToLeft"
                            [cachedFilterValue]="filter.description"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
                <th class="text-right">
                    <span>Account</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Account"
                            [filterType]="FilterType.MultiCheckbox"
                            [filterOptions]="optionsForCheckboxFilters.accounts"
                            [popupSide]="PopupSide.ToLeft"
                            [cachedFilterValue]="filter.account"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
                <th class="text-right">
                    <span>Amount</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Amount"
                            [filterType]="FilterType.NumericRange"
                            [popupSide]="PopupSide.ToLeft"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
                <th>
                    <span>Contractor</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Contractor"
                            [filterType]="FilterType.MultiCheckbox"
                            [filterOptions]="optionsForCheckboxFilters.contractors"
                            [popupSide]="PopupSide.ToLeft"
                            [cachedFilterValue]="filter.contractor"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
                <th class="text-right">
                    <span>Date</span>
                    @if (showFilters) {
                        <app-table-filter
                            [filterName]="TableColumn.Date"
                            [filterType]="FilterType.DateRange"
                            [popupSide]="PopupSide.ToLeft"
                            (filterEvent)="onPerformFilter($event)"
                        ></app-table-filter>
                    }
                </th>
            </tr>
        </thead>
        <tbody>
            @for (transfer of transfersForTable; track transferIdTracker($index, transfer)) {
                <tr [ngClass]="getTransferRowClass(transfer)">
                    @if (!transfer.isTodayMarkerRow) {
                        <td>{{ transfer.categoryName }}</td>
                        <td>
                            <a [routerLink]="CoinageRoutes.TransferDetailsPage.getUrl({ id: transfer.id })">
                                {{ transfer.description }}
                            </a>
                            @if (transfer.receiptId) {
                                <span class="planned-icon">
                                    <a [routerLink]="CoinageRoutes.ReceiptDetailsPage.getUrl({ id: transfer.receiptId })">
                                        <fa-icon [icon]="receiptIcon" [fixedWidth]="true" title="View receipt"></fa-icon>
                                    </a>
                                </span>
                            }
                            @if (transfer.isFlagged) {
                                <span class="planned-icon">
                                    <fa-icon [icon]="flagIcon" [fixedWidth]="true" title="Flagged as important"></fa-icon>
                                </span>
                            }
                        </td>
                        <td>{{ transfer.accountName }}</td>
                        <td class="currency whitespace-nowrap">
                            <app-money-amount
                                [transferData]="getTransferValueDetails(transfer)"
                                [transferAccounts]="getTransferAccountDetails(transfer)"
                            ></app-money-amount>
                        </td>
                        <td>
                            {{ transfer.contractorName | ifNull: EMPTY_CONTRACTOR }}
                        </td>
                        <!-- <td colspan="2">
            <app-money-amount [accountToAccountTransfer]="getTransferValueDetails(transfer)"></app-money-amount>
          </td> -->
                        <td class="whitespace-nowrap text-right">
                            <a [routerLink]="getSummaryPageUrl(transfer)">{{ transfer.date | date }}</a>
                        </td>
                    }
                </tr>
            }
            @if (showSummary && !noRows && outcomesCount > 0) {
                <tr class="sum-row top-border">
                    <td colspan="2">Expenses Sum</td>
                    <td>{{ outcomesCount }}</td>
                    <td class="currency">{{ outcomesSum | plnCurrency }}</td>
                    <td colspan="2"></td>
                </tr>
            }
            @if (showSummary && !noRows && incomesCount > 0) {
                <tr class="sum-row">
                    <td colspan="2">Incomes Sum</td>
                    <td>{{ incomesCount }}</td>
                    <td class="currency">{{ incomesSum | plnCurrency }}</td>
                    <td colspan="2"></td>
                </tr>
            }
            @if (noRowsFound) {
                <tr>
                    <td colspan="6">
                        <span>No transfers found.</span>
                        @if (isAnyFilterApplied && !noRows) {
                            <span> Please check filters, there are {{ transfers?.length }} unmatched transfers. </span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
    @if (showFilters && lastPageNumber) {
        <app-pagination class="float-right mt-2" [lastPage]="lastPageNumber" [currentPage]="currentPage"></app-pagination>
    }
</div>

<div #tableFilterElement class="coinage-app-table-filter">
    <button class="filter-icon-btn" (click)="onToggleOpenHide()">
        <fa-icon class="icon" [icon]="filterIcon"></fa-icon>
    </button>
    @if (isPopupDisplayed) {
        <div class="filter-popup" [ngClass]="popupSideClass">
            <form (ngSubmit)="onPerformFilter()">
                @if (filterValue.filterType === FilterType.TextBox) {
                    <div class="textbox-with-buttons" style="display:flex;gap:6px;align-items:center;">
                        <input
                            #autofocusedFilterInput
                            list="filterInputValues"
                            name="filterValue"
                            class="form-control"
                            [(ngModel)]="filterValue.value"
                            [autocomplete]="filterDataProvided ? 'off' : ''"
                        />
                        <div class="inline-filter-buttons">
                            <button type="submit" class="btn btn-outline-secondary btn-sm">Apply</button>
                            <button type="reset" class="btn btn-outline-secondary btn-sm" (click)="onClear()">Clear</button>
                        </div>
                        @if (filterDataProvided) {
                            <datalist id="filterInputValues">
                                @for (opt of datalist; track opt) {
                                    <option [value]="opt"></option>
                                }
                            </datalist>
                        }
                    </div>
                }
                @if (filterValue.filterType === FilterType.NumericRange) {
                    <div class="numeric-range">
                        <input
                            #autofocusedFilterInput
                            name="filterRangeFrom"
                            class="form-control"
                            type="number"
                            min="0"
                            [max]="filterValue.range.to ?? 0"
                            [(ngModel)]="filterValue.range.from"
                            autocomplete="off"
                        />
                        <input name="filterRangeTo" class="form-control" type="number" [min]="filterValue.range.from ?? 0" [(ngModel)]="filterValue.range.to" autocomplete="off" />
                    </div>
                }
                @if (filterValue.filterType === FilterType.DateRange) {
                    <div class="date-range-filter-container">
                        <input
                            #autofocusedFilterInput
                            name="filterDateFrom"
                            class="form-control"
                            type="date"
                            [(ngModel)]="filterValue.range.from"
                            autocomplete="off"
                            (change)="onChangeFilterRangeFrom()"
                        />
                        <input name="filterDateTo" class="form-control" type="date" [(ngModel)]="filterValue.range.to" autocomplete="off" (change)="onChangeFilterRangeTo()" />
                    </div>
                }
                @if (filterValue.filterType === FilterType.MultiCheckbox) {
                    <div class="multi-checkbox-filter-container">
                        @if (shouldDisplaySearchBox) {
                            <div class="filter-option-search-container">
                                <input
                                    #autofocusedFilterInput
                                    name="optionSearch"
                                    class="form-control filter-option-search-value"
                                    [ngModel]="optionSearchValue"
                                    (ngModelChange)="onChangeOptionSearchValue($event)"
                                    autocomplete="off"
                                    placeholder="Search..."
                                />
                                <button type="button" class="clear-button" (click)="onClearOptionsSearchValue()" title="Clear Search">X</button>
                                @if (shouldShowCheckVisibleButton) {
                                    <button type="button" class="check-visible-button" (click)="onCheckVisibleOptions()" title="Check Visible">+</button>
                                }
                            </div>
                        }
                        <div class="filter-options">
                            @if (noOptionDisplayed) {
                                <div>
                                    <span>No options found</span>
                                </div>
                            }
                            @for (option of filterOptions; track option) {
                                <div class="filter-option">
                                    @if (option.isDisplayed) {
                                        <div>
                                            <input
                                                [id]="'filter-option-checkbox-' + option.id"
                                                [name]="'filter-option-checkbox-' + option.id"
                                                type="checkbox"
                                                [(ngModel)]="option.isSelected"
                                            />
                                            <label [for]="'filter-option-checkbox-' + option.id">{{ option.uiText }}</label>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
                @if (filterValue.filterType !== FilterType.TextBox) {
                    <div class="filter-buttons">
                        <button type="submit" class="btn btn-outline-secondary btn-sm">Apply</button>
                        <button type="reset" class="btn btn-outline-secondary btn-sm" (click)="onClear()">Clear</button>
                    </div>
                }
            </form>
        </div>
    }
</div>

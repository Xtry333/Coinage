<div class="coinage-app-table-filter" #tableFilterElement>
    <button class="filter-icon-btn" (click)="onToggleOpenHide()">
        <fa-icon class="icon" [icon]="filterIcon"></fa-icon>
    </button>
    @if (isPopupDisplayed) {
        <div class="filter-popup" [ngClass]="popupSideClass">
            <form (ngSubmit)="onPerformFilter()">
                @if (filterValue.filterType === FilterType.TextBox) {
                    <div class="textbox-with-buttons" style="display: flex; gap: 6px; align-items: center">
                        <input
                            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            #autofocusedFilterInput
                            [(ngModel)]="filterValue.value"
                            [autocomplete]="filterDataProvided ? 'off' : ''"
                            list="filterInputValues"
                            name="filterValue"
                        />
                        <div class="inline-filter-buttons">
                            <button
                                class="rounded-md border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                type="submit"
                            >
                                Apply
                            </button>
                            <button
                                class="rounded-md border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                (click)="onClear()"
                                type="reset"
                            >
                                Clear
                            </button>
                        </div>
                        @if (filterDataProvided) {
                            <datalist id="filterInputValues">
                                @for (opt of datalist; track opt) {
                                    <option [value]="opt"></option>
                                }
                            </datalist>
                        }
                    </div>
                }
                @if (filterValue.filterType === FilterType.NumericRange) {
                    <div class="numeric-range">
                        <input
                            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            #autofocusedFilterInput
                            [(ngModel)]="filterValue.range.from"
                            [max]="filterValue.range.to ?? 0"
                            name="filterRangeFrom"
                            type="number"
                            min="0"
                            autocomplete="off"
                        />
                        <input
                            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            [(ngModel)]="filterValue.range.to"
                            [min]="filterValue.range.from ?? 0"
                            name="filterRangeTo"
                            type="number"
                            autocomplete="off"
                        />
                    </div>
                }
                @if (filterValue.filterType === FilterType.DateRange) {
                    <div class="date-range-filter-container">
                        <input
                            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            #autofocusedFilterInput
                            [(ngModel)]="filterValue.range.from"
                            (change)="onChangeFilterRangeFrom()"
                            name="filterDateFrom"
                            type="date"
                            autocomplete="off"
                        />
                        <input
                            class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            [(ngModel)]="filterValue.range.to"
                            (change)="onChangeFilterRangeTo()"
                            name="filterDateTo"
                            type="date"
                            autocomplete="off"
                        />
                    </div>
                }
                @if (filterValue.filterType === FilterType.MultiCheckbox) {
                    <div class="multi-checkbox-filter-container">
                        @if (shouldDisplaySearchBox) {
                            <div class="filter-option-search-container">
                                <input
                                    class="filter-option-search-value w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    #autofocusedFilterInput
                                    [ngModel]="optionSearchValue"
                                    (ngModelChange)="onChangeOptionSearchValue($event)"
                                    name="optionSearch"
                                    autocomplete="off"
                                    placeholder="Search..."
                                />
                                <button class="clear-button" (click)="onClearOptionsSearchValue()" type="button" title="Clear Search">X</button>
                                @if (shouldShowCheckVisibleButton) {
                                    <button class="check-visible-button" (click)="onCheckVisibleOptions()" type="button" title="Check Visible">+</button>
                                }
                            </div>
                        }
                        <div class="filter-options">
                            @if (noOptionDisplayed) {
                                <div>
                                    <span>No options found</span>
                                </div>
                            }
                            @for (option of filterOptions; track option) {
                                <div class="filter-option">
                                    @if (option.isDisplayed) {
                                        <div>
                                            <input
                                                [(ngModel)]="option.isSelected"
                                                [id]="'filter-option-checkbox-' + option.id"
                                                [name]="'filter-option-checkbox-' + option.id"
                                                type="checkbox"
                                            />
                                            <label [for]="'filter-option-checkbox-' + option.id">{{ option.uiText }}</label>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
                @if (filterValue.filterType !== FilterType.TextBox) {
                    <div class="filter-buttons">
                        <button
                            class="rounded-md border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            type="submit"
                        >
                            Apply
                        </button>
                        <button
                            class="rounded-md border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            (click)="onClear()"
                            type="reset"
                        >
                            Clear
                        </button>
                    </div>
                }
            </form>
        </div>
    }
</div>
